package com.clush.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

import com.clush.dto.ToDoDto;
import com.clush.entity.CalendarEntity;
import com.clush.entity.TodoEntity;
import com.clush.respository.CalendarRepository;
import com.clush.respository.ToDoRepository;

@Service
public class ToDoService {

	@Autowired
	private ToDoRepository toDoRepository;
	@Autowired
	private CalendarRepository calendarRepository;
	
	public ResponseEntity<Void> saveToDoService(ToDoDto toDoDto){
		
		//추가된 작업의 날짜에 해당하는 캘린더 Entity 호출
	    CalendarEntity calendarEntity = calendarRepository.findByDate(toDoDto.getDate());
	    
	    if (calendarEntity == null) { // 없으면 추가

	        calendarEntity = new CalendarEntity();
	        calendarEntity.setDate(toDoDto.getDate());
	    }
	    
	    TodoEntity todoEntity = new TodoEntity(toDoDto);
	    	   
	    todoEntity.setCalendar(calendarEntity); 
	    calendarEntity.getTodos().add(todoEntity); 
	    
	    calendarRepository.save(calendarEntity);
		
		return ResponseEntity.ok().build();
	}
	
}
